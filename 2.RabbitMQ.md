## RabbitMQ ç®€ä»‹

RabbitMQ æ˜¯ä¸€ä¸ªå¼€æºçš„ **æ¶ˆæ¯ä»£ç†ï¼ˆMessage Brokerï¼‰** å’Œ **é˜Ÿåˆ—æœåŠ¡å™¨**ï¼ŒåŸºäº **AMQPï¼ˆAdvanced Message Queuing Protocolï¼‰** åè®®å®ç°ï¼Œç”¨äºåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å®ç°**åº”ç”¨è§£è€¦ã€å¼‚æ­¥é€šä¿¡ã€æµé‡å‰Šå³°ã€å¯é ä¼ é€’**ç­‰æ ¸å¿ƒèƒ½åŠ›ã€‚

ğŸ“š å®˜ç½‘ï¼šhttps://www.rabbitmq.com
ğŸ“˜ æ–‡æ¡£ï¼šhttps://www.rabbitmq.com/documentation.html

------

## ğŸŒŸ æ ¸å¿ƒç‰¹æ€§

| ç‰¹æ€§                               | è¯´æ˜                                                         |
| ---------------------------------- | ------------------------------------------------------------ |
| **å¯é æ€§ï¼ˆReliabilityï¼‰**          | æ”¯æŒæ¶ˆæ¯æŒä¹…åŒ–ã€å‘å¸ƒç¡®è®¤ï¼ˆPublisher Confirmsï¼‰ã€æ‰‹åŠ¨ ACKï¼Œç¡®ä¿æ¶ˆæ¯ä¸ä¸¢å¤± |
| **çµæ´»çš„è·¯ç”±ï¼ˆFlexible Routingï¼‰** | é€šè¿‡ Exchange + Binding + Routing Key å®ç°å¤æ‚è·¯ç”±é€»è¾‘       |
| **é›†ç¾¤ä¸é«˜å¯ç”¨**                   | æ”¯æŒå¤šèŠ‚ç‚¹é›†ç¾¤ã€é•œåƒé˜Ÿåˆ—ï¼ˆMirrored Queuesï¼‰ï¼Œä¿éšœæœåŠ¡é«˜å¯ç”¨  |
| **å¤šåè®®æ”¯æŒ**                     | åŸç”Ÿæ”¯æŒ AMQP 0.9.1ï¼Œä¹Ÿæ”¯æŒ MQTTã€STOMPã€HTTP ç­‰æ’ä»¶         |
| **ç®¡ç†ç•Œé¢**                       | æä¾› Web UIï¼ˆ15672 ç«¯å£ï¼‰ï¼Œå¯è§†åŒ–ç›‘æ§é˜Ÿåˆ—ã€è¿æ¥ã€æ¶ˆæ¯ç­‰      |
| **å¤šè¯­è¨€å®¢æˆ·ç«¯**                   | å®˜æ–¹æ”¯æŒ Javaã€Pythonã€.NETã€Goã€JavaScript ç­‰ä¸»æµè¯­è¨€       |
| **æ’ä»¶ç”Ÿæ€**                       | ä¸°å¯Œçš„æ’ä»¶ç³»ç»Ÿï¼ˆå¦‚å»¶è¿Ÿé˜Ÿåˆ—ã€æ¶ˆæ¯è¿½è¸ªã€è®¤è¯ç­‰ï¼‰               |

------

## ğŸ“¦ æ ¸å¿ƒæ¦‚å¿µï¼ˆAMQP æ¨¡å‹ï¼‰

### 1. **Producerï¼ˆç”Ÿäº§è€…ï¼‰**

- å‘é€æ¶ˆæ¯çš„åº”ç”¨ç¨‹åº
- ä¸ç›´æ¥å‘é€åˆ°é˜Ÿåˆ—ï¼Œè€Œæ˜¯å‘é€åˆ° **Exchange**

### 2. **Consumerï¼ˆæ¶ˆè´¹è€…ï¼‰**

- æ¥æ”¶å¹¶å¤„ç†æ¶ˆæ¯çš„åº”ç”¨ç¨‹åº
- ä» **Queue** ä¸­æ‹‰å–æ¶ˆæ¯

### 3. **Queueï¼ˆé˜Ÿåˆ—ï¼‰**

- å­˜å‚¨æ¶ˆæ¯çš„ç¼“å†²åŒº
- FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰ï¼Œæ¶ˆæ¯åœ¨è¢«æ¶ˆè´¹å‰ä¸€ç›´ä¿ç•™ï¼ˆå¯é…ç½® TTLï¼‰

### 4. **Exchangeï¼ˆäº¤æ¢æœºï¼‰**

- æ¶ˆæ¯çš„â€œè·¯ç”±å™¨â€ï¼Œå†³å®šæ¶ˆæ¯å¦‚ä½•åˆ†å‘åˆ°é˜Ÿåˆ—
- ç±»å‹å†³å®šè·¯ç”±è¡Œä¸ºï¼š

| Exchange ç±»å‹ | è·¯ç”±è§„åˆ™                                 |
| ------------- | ---------------------------------------- |
| **Direct**    | ç²¾ç¡®åŒ¹é… `routing key`                   |
| **Fanout**    | å¹¿æ’­åˆ°æ‰€æœ‰ç»‘å®šçš„é˜Ÿåˆ—ï¼ˆå¿½ç•¥ routing keyï¼‰ |
| **Topic**     | æ¨¡ç³ŠåŒ¹é…ï¼ˆæ”¯æŒ `*` å’Œ `#` é€šé…ç¬¦ï¼‰       |
| **Headers**   | åŸºäºæ¶ˆæ¯å¤´ï¼ˆheadersï¼‰åŒ¹é…ï¼ˆè¾ƒå°‘ç”¨ï¼‰      |

### 5. **Bindingï¼ˆç»‘å®šï¼‰**

- å»ºç«‹ Exchange ä¸ Queue ä¹‹é—´çš„å…³è”è§„åˆ™
- å¯åŒ…å« `routing key` æˆ– `headers`

### 6. **Routing Keyï¼ˆè·¯ç”±é”®ï¼‰**

- ç”Ÿäº§è€…å‘é€æ¶ˆæ¯æ—¶æŒ‡å®šçš„å­—ç¬¦ä¸²
- Exchange æ ¹æ®å®ƒå†³å®šæ¶ˆæ¯å»å‘

------

## ğŸ”„ æ¶ˆæ¯æµè½¬æµç¨‹

```mermaid
graph LR

A[Producer] -->|å‘é€æ¶ˆæ¯ + routing key| B(Exchange)

B -->|æ ¹æ® binding è§„åˆ™| C[Queue 1]

B -->|æ ¹æ® binding è§„åˆ™| D[Queue 2]

C --> E[Consumer 1]

D --> F[Consumer 2]
```

âœ… **å…³é”®ç‚¹**ï¼šç”Ÿäº§è€… **ä¸çŸ¥é“é˜Ÿåˆ—çš„å­˜åœ¨**ï¼Œåªä¸ Exchange äº¤äº’ã€‚

## ğŸ› ï¸ å…¸å‹åº”ç”¨åœºæ™¯

| åœºæ™¯           | è¯´æ˜                                         |
| -------------- | -------------------------------------------- |
| **å¼‚æ­¥å¤„ç†**   | ç”¨æˆ·æ³¨å†Œåå¼‚æ­¥å‘é‚®ä»¶ã€çŸ­ä¿¡                   |
| **åº”ç”¨è§£è€¦**   | è®¢å•æœåŠ¡ä¸åº“å­˜æœåŠ¡é€šè¿‡æ¶ˆæ¯é€šä¿¡ï¼Œé¿å…ç›´æ¥è°ƒç”¨ |
| **æµé‡å‰Šå³°**   | ç§’æ€ç³»ç»Ÿå°†è¯·æ±‚æš‚å­˜é˜Ÿåˆ—ï¼Œåç«¯å¹³ç¨³æ¶ˆè´¹         |
| **æ—¥å¿—å¤„ç†**   | æ”¶é›†æ—¥å¿—åˆ°é˜Ÿåˆ—ï¼Œç”±ä¸“é—¨æœåŠ¡åˆ†æ               |
| **æœ€ç»ˆä¸€è‡´æ€§** | åˆ†å¸ƒå¼äº‹åŠ¡ä¸­é€šè¿‡æ¶ˆæ¯å®ç°çŠ¶æ€åŒæ­¥             |
| **å¹¿æ’­é€šçŸ¥**   | ä½¿ç”¨ Fanout Exchange å‘å¤šä¸ªæœåŠ¡å¹¿æ’­äº‹ä»¶      |

------

## âš™ï¸ é«˜çº§åŠŸèƒ½

### 1. **æ¶ˆæ¯ç¡®è®¤æœºåˆ¶**

- **ç”Ÿäº§è€…ç¡®è®¤ï¼ˆPublisher Confirmsï¼‰**ï¼šBroker æ”¶åˆ°æ¶ˆæ¯åå›è°ƒé€šçŸ¥ç”Ÿäº§è€…
- **æ¶ˆè´¹è€… ACK**ï¼šæ‰‹åŠ¨ç¡®è®¤ï¼ˆ`ack`ï¼‰æˆ–è‡ªåŠ¨ç¡®è®¤ï¼ˆ`autoAck`ï¼‰ï¼Œé¿å…æ¶ˆæ¯ä¸¢å¤±

### 2. **æŒä¹…åŒ–**

- Exchangeã€Queueã€Message å‡å¯è®¾ä¸º **durable**ï¼ŒBroker é‡å¯åä¸ä¸¢å¤±

### 3. **æ­»ä¿¡é˜Ÿåˆ—ï¼ˆDLXï¼‰**

- æ¶ˆæ¯è¢«æ‹’ç»ã€TTL è¿‡æœŸæˆ–é˜Ÿåˆ—æ»¡æ—¶ï¼Œè‡ªåŠ¨è½¬å…¥ **Dead Letter Exchange**
- ç”¨äºå¼‚å¸¸å¤„ç†ã€å»¶è¿Ÿé‡è¯•ç­‰

### 4. **å»¶è¿Ÿé˜Ÿåˆ—**

- é€šè¿‡æ’ä»¶ `rabbitmq-delayed-message-exchange` å®ç°
- æˆ–ç”¨ TTL + DLX æ¨¡æ‹Ÿ

### 5. **é•œåƒé˜Ÿåˆ—ï¼ˆMirrored Queuesï¼‰**

- é˜Ÿåˆ—å†…å®¹åœ¨é›†ç¾¤å¤šä¸ªèŠ‚ç‚¹å¤åˆ¶ï¼Œå®ç°é«˜å¯ç”¨



## âœ… æ€»ç»“

> **RabbitMQ æ˜¯ä¸€ä¸ªæˆç†Ÿã€ç¨³å®šã€åŠŸèƒ½ä¸°å¯Œçš„æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œç‰¹åˆ«é€‚åˆéœ€è¦å¯é ä¼ é€’ã€çµæ´»è·¯ç”±å’Œå¤æ‚ä¸šåŠ¡é›†æˆçš„åœºæ™¯ã€‚**

å®ƒä»¥ **AMQP åè®®ä¸ºæ ¸å¿ƒ**ï¼Œé€šè¿‡ **Exchange/Queue/Binding** æ¨¡å‹æä¾›äº†æå¼ºçš„çµæ´»æ€§ï¼Œé…åˆæŒä¹…åŒ–ã€ACKã€æ­»ä¿¡é˜Ÿåˆ—ç­‰æœºåˆ¶ï¼Œæˆä¸ºä¼ä¸šçº§åº”ç”¨çš„é¦–é€‰æ¶ˆæ¯è§£å†³æ–¹æ¡ˆã€‚

## ğŸ¥‡é›†æˆç¤ºä¾‹

âœ¨ä»£ç æ–‡ä»¶ï¼š[middleware-message/rabbitmq at master Â· xiaopengooo0/middleware-message](https://github.com/xiaopengooo0/middleware-message/tree/master/rabbitmq)

### 1.ä¾èµ–å¼•å…¥

```xml
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-amqp</artifactId>
        </dependency>
```

### 2.é…ç½®æ–‡ä»¶

```yml
spring:
  rabbitmq:
    host: localhost
    port: 5672
    username: rabbit
    password: message
    virtual-host: /
    # ç”Ÿäº§è€…é…ç½®
    publisher-confirm-type: correlated
    publisher-returns: true
    # æ¶ˆè´¹è€…é…ç½®
    listener:
      simple:
        acknowledge-mode: manual
        prefetch: 10
    # æ·»åŠ è¿æ¥ç›¸å…³é…ç½®
    connection-timeout: 60000
```

### 3. é…ç½®æ³¨å…¥

```java
@Configuration
public class RabbitMQConfig {


    // ç›´è¿äº¤æ¢æœº
    public static final String DIRECT_EXCHANGE = "direct.exchange";
    public static final String DIRECT_QUEUE = "direct.queue";
    public static final String DIRECT_ROUTING_KEY = "direct.routing.key";

    // ä¸»é¢˜äº¤æ¢æœº
    public static final String TOPIC_EXCHANGE = "topic.exchange";
    public static final String TOPIC_QUEUE = "topic.queue";
    // ä¿®æ”¹ç»‘å®šé”®ä»¥åŒ¹é…æµ‹è¯•ä¸­çš„è·¯ç”±é”®
    public static final String TOPIC_BINDING_KEY = "topic.message.*";
    private static final Logger log = LoggerFactory.getLogger(RabbitMQConfig.class);


    /**
     * åˆ›å»ºä¸€ä¸ªæŒä¹…åŒ–çš„ç›´è¿äº¤æ¢æœºï¼Œå‚æ•°ä¸ºï¼šäº¤æ¢æœºåç§°ã€æŒä¹…åŒ–(true)ã€ä¸è‡ªåŠ¨åˆ é™¤(false)
     * @return
     */
    @Bean
    public DirectExchange directExchange() {
        return new DirectExchange(DIRECT_EXCHANGE, true, false);
    }

    /**
     * åˆ›å»ºä¸€ä¸ªæŒä¹…åŒ–çš„é˜Ÿåˆ—ï¼Œå‚æ•°ä¸ºï¼šé˜Ÿåˆ—åç§°ã€æŒä¹…åŒ–(true)ã€æ’ä»–(false)ã€è‡ªåŠ¨åˆ é™¤(false)
     * @return
     */
    @Bean
    public Queue directQueue() {
        return new Queue(DIRECT_QUEUE, true, false, false);
    }


    /**
     * åˆ›å»ºä¸€ä¸ªç›´è¿ç»‘å®šå…³ç³»
     * @return
     */
    @Bean
    public Binding directBinding() {
        return BindingBuilder.bind(directQueue())
                .to(directExchange())
                .with(DIRECT_ROUTING_KEY);
    }

    /**
     * åˆ›å»ºä¸€ä¸ªä¸»é¢˜äº¤æ¢æœºï¼Œå‚æ•°ä¸ºï¼šäº¤æ¢æœºåç§°ã€æŒä¹…åŒ–(true)ã€ä¸è‡ªåŠ¨åˆ é™¤(false)
     * @return
     */
    @Bean
    public TopicExchange topicExchange() {
        return new TopicExchange(TOPIC_EXCHANGE, true, false);
    }

    /**
     * åˆ›å»ºä¸€ä¸ªæŒä¹…åŒ–çš„é˜Ÿåˆ—ï¼Œå‚æ•°ä¸ºï¼šé˜Ÿåˆ—åç§°ã€æŒä¹…åŒ–(true)ã€æ’ä»–(false)ã€è‡ªåŠ¨åˆ é™¤(false)
     * @return
     */
    @Bean
    public Queue topicQueue() {
        return new Queue(TOPIC_QUEUE, true, false, false);
    }

    /**
     * åˆ›å»ºä¸€ä¸ªä¸»é¢˜ç»‘å®šå…³ç³»
     * @return
     */
    @Bean
    public Binding topicBinding() {
        return BindingBuilder.bind(topicQueue())
                .to(topicExchange())
                // ä½¿ç”¨èƒ½åŒ¹é…æµ‹è¯•ä¸­è·¯ç”±é”®çš„ç»‘å®šé”®
                .with(TOPIC_BINDING_KEY);
    }


    @Bean
    public Queue dlxQueue() {
        return QueueBuilder
                .durable("dlx.queue") // å¿…é¡»å’Œå·²æœ‰é˜Ÿåˆ—ä¸€è‡´
                .build();
    }


    /**
     * åˆ›å»ºä¸€ä¸ªæ¶ˆæ¯ç¡®è®¤å›è°ƒï¼Œå‚æ•°ä¸ºï¼šç¡®è®¤å›è°ƒã€å¤±è´¥å›è°ƒ
     * @return
     */
    @Bean
    public RabbitTemplate.ConfirmCallback confirmCallback() {
        // æ¶ˆæ¯ç¡®è®¤å›è°ƒ correlationData æ¶ˆæ¯å”¯ä¸€æ ‡è¯†ç¬¦ ,ack æ˜¯å¦æˆåŠŸ ,cause å¤±è´¥åŸå› 

        return (correlationData, ack, cause) -> {
            if (ack) {
                log.info("Message confirmed, correlationData: {}", correlationData);
            } else {
                log.error("Message failed, cause: {}", cause);
            }
        };
    }
    

    
    /**
     * é…ç½®RabbitTemplate
     * @param connectionFactory
     * @return
     */
    @Bean
    public RabbitTemplate rabbitTemplate(ConnectionFactory connectionFactory) {
        RabbitTemplate template = new RabbitTemplate(connectionFactory);
        template.setConfirmCallback(confirmCallback());
        template.setReturnsCallback(returned -> {
            log.error("Message returned: exchange={}, routingKey={}, replyCode={}, replyText={}",
                    returned.getExchange(), returned.getRoutingKey(),
                    returned.getReplyCode(), returned.getReplyText());
        });
        // å¯ç”¨æ¶ˆæ¯è¿”å›åŠŸèƒ½
        template.setMandatory(true);
        return template;
    }
}
```

### 4.ç”Ÿäº§è€…é…ç½®

```java
@Component
public class RabbitMQProducer {

    private static final Logger log = LoggerFactory.getLogger(RabbitMQProducer.class);
    
    @Autowired
    private RabbitTemplate rabbitTemplate;

    
    // å‘é€åˆ°ç›´è¿äº¤æ¢æœº
    public void sendDirectMessage(String message) {
        log.info("å‘é€åˆ°ç›´è¿äº¤æ¢æœºï¼š{}", message);
        rabbitTemplate.convertAndSend(
            RabbitMQConfig.DIRECT_EXCHANGE,
            RabbitMQConfig.DIRECT_ROUTING_KEY,
            message,
            // è®¾ç½®æ¶ˆæ¯æŒä¹…åŒ–
            msg -> {
                msg.getMessageProperties().setDeliveryMode(MessageDeliveryMode.PERSISTENT);
                return msg;
            },
                new CorrelationData(UUID.randomUUID().toString())
        );
    }
    
    // å‘é€åˆ°ä¸»é¢˜äº¤æ¢æœº
    public void sendTopicMessage(String routingKey, String message) {
        log.info("å‘é€åˆ°ä¸»é¢˜äº¤æ¢æœºï¼š{} - {}", routingKey, message);
        rabbitTemplate.convertAndSend(
            RabbitMQConfig.TOPIC_EXCHANGE,
            routingKey,
            message, new CorrelationData(UUID.randomUUID().toString())
        );
    }
    
    // å‘é€å¸¦ç¡®è®¤çš„æ¶ˆæ¯
    public void sendMessageWithConfirm(String message) {
        log.info("å‘é€å¸¦ç¡®è®¤æ¶ˆæ¯ï¼š{}", message);
        CorrelationData correlationData = new CorrelationData(UUID.randomUUID().toString());
        
        rabbitTemplate.convertAndSend(
            RabbitMQConfig.DIRECT_EXCHANGE,
            RabbitMQConfig.DIRECT_ROUTING_KEY,
            message,
            correlationData
        );
    }
}
```

### 5.æ¶ˆè´¹è€…é…ç½®

```java
@Component
public class RabbitMQConsumer {

    private static final Logger log = LoggerFactory.getLogger(RabbitMQConsumer.class);

    // ç›´è¿é˜Ÿåˆ—æ¶ˆè´¹è€…

    /**
     *  ç›‘å¬ç›´è¿é˜Ÿåˆ—
     * @param message æ¶ˆæ¯
     * @param channel   é¢‘é“
     * @param deliveryTag æ¶ˆæ¯çš„æ ‡è¯†
     */
    @RabbitListener(queues = RabbitMQConfig.DIRECT_QUEUE)
    public void processDirectMessage(String message, Channel channel,
                                   @Header(AmqpHeaders.DELIVERY_TAG) long deliveryTag) {
        try {
            log.info("Received direct message: {}", message);
            // ä¸šåŠ¡å¤„ç†
            processBusiness(message);
            // æ‰‹åŠ¨ç¡®è®¤
            channel.basicAck(deliveryTag, false);
        } catch (Exception e) {
            log.error("å¤„ç†ç›´è¿æ¶ˆæ¯å¤±è´¥: ", e);
            try {
                // æ‹’ç»æ¶ˆæ¯ï¼Œé‡æ–°å…¥é˜Ÿ
                channel.basicNack(deliveryTag, false, true);
            } catch (IOException ex) {
                log.error("æ‹’ç»æ¶ˆæ¯å¤±è´¥: ", ex);
            }
        }
    }
    
    // ä¸»é¢˜é˜Ÿåˆ—æ¶ˆè´¹è€…

    /**
     *  ç›‘å¬ä¸»é¢˜é˜Ÿåˆ—
     * @param message   æ¶ˆæ¯
     * @param amqpMessage  AMQPæ¶ˆæ¯
     */
    @RabbitListener(queues = RabbitMQConfig.TOPIC_QUEUE)
    public void processTopicMessage(String message, Message amqpMessage) {
        String routingKey = amqpMessage.getMessageProperties().getReceivedRoutingKey();
        log.info("Received topic message with routing key {}: {}", routingKey, message);
        processBusiness(message);
    }
    
    // æ­»ä¿¡é˜Ÿåˆ—å¤„ç†
    @RabbitListener(queues = "dlx.queue")
    public void processDeadLetterMessage(String message) {
        log.info("---------Received dead letter message: {}", message);
        // å¤„ç†æ­»ä¿¡æ¶ˆæ¯
    }
    
    private void processBusiness(String message) {
        // å…·ä½“çš„ä¸šåŠ¡å¤„ç†é€»è¾‘
        log.info("---------Processing message: {}", message);
    }
}
```

### 6. æµ‹è¯•æ¶ˆæ¯

```java
@SpringBootTest
@RunWith(SpringRunner.class)
public class ApiTest {

    @Resource
    private RabbitMQProducer rabbitMQProducer;

    @Test
    public void sendMessage() throws InterruptedException {
        rabbitMQProducer.sendDirectMessage("hello rabbitmq");
        rabbitMQProducer.sendTopicMessage("topic.message", "hello top rabbitmq");
        rabbitMQProducer.sendTopicMessage("topic.message.top", "hello top rabbitmq");
        rabbitMQProducer.sendMessageWithConfirm("hello rabbitmq");
        
        // å¢åŠ ç­‰å¾…æ—¶é—´ç¡®ä¿æ¶ˆè´¹è€…å¤„ç†å®Œæ¶ˆæ¯
        Thread.sleep(10000);
    }
}
```

### è¾“å‡ºç¤ºä¾‹

```powershell
2025-10-31 11:00:25.634  INFO 33212 --- [           main] c.s.m.r.producer.RabbitMQProducer        : å‘é€åˆ°ç›´è¿äº¤æ¢æœºï¼šhello rabbitmq
2025-10-31 11:00:25.643  INFO 33212 --- [           main] c.s.m.r.producer.RabbitMQProducer        : å‘é€åˆ°ä¸»é¢˜äº¤æ¢æœºï¼štopic.message - hello top rabbitmq
2025-10-31 11:00:25.647  INFO 33212 --- [           main] c.s.m.r.producer.RabbitMQProducer        : å‘é€åˆ°ä¸»é¢˜äº¤æ¢æœºï¼štopic.message.top - hello top rabbitmq
2025-10-31 11:00:25.647  INFO 33212 --- [ntContainer#0-1] c.s.m.r.consumer.RabbitMQConsumer        : Received direct message: hello rabbitmq
2025-10-31 11:00:25.647  INFO 33212 --- [ntContainer#0-1] c.s.m.r.consumer.RabbitMQConsumer        : ---------Processing message: hello rabbitmq
2025-10-31 11:00:25.648  INFO 33212 --- [ntContainer#2-1] c.s.m.r.consumer.RabbitMQConsumer        : Received topic message with routing key topic.message: hello top rabbitmq
2025-10-31 11:00:25.649  INFO 33212 --- [ntContainer#2-1] c.s.m.r.consumer.RabbitMQConsumer        : ---------Processing message: hello top rabbitmq
2025-10-31 11:00:25.650  INFO 33212 --- [nectionFactory1] c.s.m.rabbitmq.config.RabbitMQConfig     : Message confirmed, correlationData: CorrelationData [id=945ea7ff-83ed-4fb7-9276-a233692632c2]
2025-10-31 11:00:25.651  INFO 33212 --- [           main] c.s.m.r.producer.RabbitMQProducer        : å‘é€å¸¦ç¡®è®¤æ¶ˆæ¯ï¼šhello confirm rabbitmq
2025-10-31 11:00:25.652  INFO 33212 --- [nectionFactory1] c.s.m.rabbitmq.config.RabbitMQConfig     : Message confirmed, correlationData: CorrelationData [id=8b115f4c-1d75-4904-bc11-a1cd9ebc5394]
2025-10-31 11:00:25.653  INFO 33212 --- [ntContainer#2-1] c.s.m.r.consumer.RabbitMQConsumer        : Received topic message with routing key topic.message.top: hello top rabbitmq
2025-10-31 11:00:25.653  INFO 33212 --- [ntContainer#0-1] c.s.m.r.consumer.RabbitMQConsumer        : Received direct message: hello confirm rabbitmq
2025-10-31 11:00:25.653  INFO 33212 --- [ntContainer#0-1] c.s.m.r.consumer.RabbitMQConsumer        : ---------Processing message: hello confirm rabbitmq
2025-10-31 11:00:25.653  INFO 33212 --- [ntContainer#2-1] c.s.m.r.consumer.RabbitMQConsumer        : ---------Processing message: hello top rabbitmq
2025-10-31 11:00:25.656  INFO 33212 --- [nectionFactory1] c.s.m.rabbitmq.config.RabbitMQConfig     : Message confirmed, correlationData: CorrelationData [id=81dc7ad8-4ab6-400d-bff1-c2590c5ff2cc]
2025-10-31 11:00:25.656  INFO 33212 --- [nectionFactory2] c.s.m.rabbitmq.config.RabbitMQConfig     : Message confirmed, correlationData: CorrelationData [id=5ddf2519-5e73-481a-ba1b-6ae8cd0479ef]

```

### docker é…ç½®

`docker-compose.yml`

```yml
services:
  # RabbitMQ
  rabbitmq:
    image: rabbitmq:3-management
    environment:
      - RABBITMQ_DEFAULT_USER=rabbit
      - RABBITMQ_DEFAULT_PASS=message
    ports:
      - "5672:5672"
      - "15672:15672"

```

é•œåƒåœ°å€ï¼š`swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/rabbitmq:3-management-linuxarm64`

