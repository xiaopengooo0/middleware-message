## Apache Pulsar ç®€ä»‹

**Apache Pulsar** æ˜¯ä¸€ä¸ªäº‘åŸç”Ÿã€åˆ†å¸ƒå¼ã€é«˜æ€§èƒ½çš„**å‘å¸ƒ-è®¢é˜…æ¶ˆæ¯ç³»ç»Ÿ**ï¼Œæœ€åˆç”± Yahoo å¼€å‘ï¼Œäº 2016 å¹´å¼€æºï¼Œ2018 å¹´æˆä¸º Apache é¡¶çº§é¡¹ç›®ã€‚Pulsar è¢«è®¾è®¡ç”¨äº**å¤§è§„æ¨¡ã€å¤šç§Ÿæˆ·ã€é«˜å¯é ã€ä½å»¶è¿Ÿ**çš„åœºæ™¯ï¼Œæ˜¯ Kafka çš„æœ‰åŠ›ç«äº‰è€…ï¼Œå°¤å…¶åœ¨**äº‘åŸç”Ÿæ¶æ„**å’Œ**ç»Ÿä¸€æ¶ˆæ¯/æµå¤„ç†å¹³å°**æ–¹é¢å…·æœ‰æ˜¾è‘—ä¼˜åŠ¿ã€‚

ğŸ“š å®˜ç½‘ï¼šhttps://pulsar.apache.org
ğŸ“˜ GitHubï¼šhttps://github.com/apache/pulsar
ğŸ“˜ æ–‡æ¡£ï¼šhttps://pulsar.apache.org/docs

------

## ğŸŒŸ æ ¸å¿ƒç‰¹æ€§

| ç‰¹æ€§                            | è¯´æ˜                                                      |
| ------------------------------- | --------------------------------------------------------- |
| **äº‘åŸç”Ÿæ¶æ„**                  | åŸºäºåˆ†å±‚å­˜å‚¨ï¼ˆTiered Storageï¼‰ï¼Œå¤©ç„¶æ”¯æŒ Kubernetes éƒ¨ç½²  |
| **è®¡ç®—ä¸å­˜å‚¨åˆ†ç¦»**              | Brokerï¼ˆæ— çŠ¶æ€ï¼‰ + BookKeeperï¼ˆæœ‰çŠ¶æ€ï¼‰ï¼Œç‹¬ç«‹æ‰©ç¼©å®¹       |
| **å¤šç§Ÿæˆ·æ”¯æŒ**                  | åŸç”Ÿæ”¯æŒ Namespace/Topic çº§åˆ«çš„é…é¢ã€éš”ç¦»å’Œæƒé™æ§åˆ¶       |
| **é«˜åå & ä½å»¶è¿Ÿ**             | æ”¯æŒç™¾ä¸‡çº§ TPSï¼Œç«¯åˆ°ç«¯å»¶è¿Ÿå¯ä½è‡³æ¯«ç§’çº§                    |
| **æŒä¹…åŒ– & å¼ºä¸€è‡´æ€§**           | åŸºäº Apache BookKeeperï¼Œæä¾› Quorum å†™å…¥å’Œå¼ºä¸€è‡´æ€§ä¿è¯    |
| **ç»Ÿä¸€æ¶ˆæ¯æ¨¡å‹**                | åŒæ—¶æ”¯æŒ **é˜Ÿåˆ—ï¼ˆQueueï¼‰** å’Œ **æµï¼ˆStreamï¼‰** æ¶ˆè´¹æ¨¡å¼   |
| **åœ°ç†å¤åˆ¶ï¼ˆGeo-Replicationï¼‰** | è·¨æ•°æ®ä¸­å¿ƒ/äº‘åŒºåŸŸè‡ªåŠ¨å¼‚æ­¥å¤åˆ¶æ¶ˆæ¯                         |
| **Schema Registry**             | å†…ç½® Schema ç®¡ç†ï¼Œæ”¯æŒ Avroã€JSONã€Protobuf ç­‰            |
| **Functions / IO**              | å†…ç½®è½»é‡çº§æµå¤„ç†ï¼ˆPulsar Functionsï¼‰å’Œè¿æ¥å™¨ï¼ˆPulsar IOï¼‰ |

------

## ğŸ“¦ æ ¸å¿ƒæ¶æ„ï¼šè®¡ç®—ä¸å­˜å‚¨åˆ†ç¦»

è¿™æ˜¯ Pulsar **æœ€æ ¸å¿ƒçš„åˆ›æ–°**ï¼ŒåŒºåˆ«äº Kafka/RocketMQ çš„â€œè®¡ç®—å­˜å‚¨ä¸€ä½“â€æ¶æ„ã€‚

### æ¶æ„ç»„ä»¶

```mermaid
graph LR
    subgraph "Client"
        Producer --> Broker
        Consumer --> Broker
    end

    subgraph "Pulsar Cluster"
        Broker[Broker<br/>æ— çŠ¶æ€] --> BookKeeper[Apache BookKeeper<br/>åˆ†å¸ƒå¼æ—¥å¿—å­˜å‚¨]
        Broker --> ZK[Configuration Store<br/>ZooKeeper]
        Broker --> Metadata[Metadata Store<br/>ZooKeeper]
    end

    BookKeeper -->|Ledgers| Journal[Journal Disk]
    BookKeeper -->|Index| IndexDisk[Index Disk]

```

### å„ç»„ä»¶èŒè´£

| ç»„ä»¶           | è¯´æ˜                                                         |
| -------------- | ------------------------------------------------------------ |
| **Broker**     | æ— çŠ¶æ€æœåŠ¡èŠ‚ç‚¹ï¼Œè´Ÿè´£å¤„ç† Producer/Consumer è¯·æ±‚ã€åè®®è½¬æ¢ã€è´Ÿè½½å‡è¡¡ã€‚**å¯æ°´å¹³æ‰©å±•**ï¼Œé‡å¯æ— æ•°æ®ä¸¢å¤±é£é™©ã€‚ |
| **BookKeeper** | åˆ†å¸ƒå¼ WALï¼ˆWrite-Ahead Logï¼‰ç³»ç»Ÿï¼Œè´Ÿè´£**æŒä¹…åŒ–å­˜å‚¨æ¶ˆæ¯**ã€‚æ•°æ®åˆ†ç‰‡ä¸º **Ledger**ï¼Œå¤šå‰¯æœ¬å†™å…¥ï¼ˆé€šå¸¸ 3 å‰¯æœ¬ï¼‰ï¼Œå¼ºä¸€è‡´æ€§ã€‚ |
| **ZooKeeper**  | å­˜å‚¨é›†ç¾¤å…ƒæ•°æ®ï¼ˆMetadata Storeï¼‰å’Œé…ç½®ï¼ˆConfiguration Storeï¼‰ï¼Œ**ä¸å‚ä¸æ¶ˆæ¯è¯»å†™è·¯å¾„**ã€‚ |

> âœ… **ä¼˜åŠ¿**ï¼š
>
> - **Broker æ— çŠ¶æ€**ï¼šæ‰©ç¼©å®¹ç§’çº§å®Œæˆï¼Œä¸å½±å“æœåŠ¡
> - **å­˜å‚¨ç‹¬ç«‹æ‰©å±•**ï¼šæ¶ˆæ¯å †ç§¯ä¸å½±å“ Broker æ€§èƒ½
> - **æ•…éšœéš”ç¦»**ï¼šBroker å®•æœºä¸å½±å“æ•°æ®ï¼ŒBookKeeper èŠ‚ç‚¹æ•…éšœè‡ªåŠ¨æ¢å¤

## ğŸ“Œ æ ¸å¿ƒæ¦‚å¿µ

| æ¦‚å¿µ                      | è¯´æ˜                                                         |
| ------------------------- | ------------------------------------------------------------ |
| **Tenantï¼ˆç§Ÿæˆ·ï¼‰**        | æœ€é«˜å±‚çº§éš”ç¦»å•ä½ï¼Œé€‚åˆå¤šå›¢é˜Ÿ/å¤šå®¢æˆ·ï¼ˆå¦‚ï¼š`finance`, `marketing`ï¼‰ |
| **Namespaceï¼ˆå‘½åç©ºé—´ï¼‰** | ç§Ÿæˆ·ä¸‹çš„é€»è¾‘åˆ†ç»„ï¼Œç”¨äºé…ç½®ç­–ç•¥ï¼ˆå¦‚ TTLã€Retentionã€Replicationï¼‰ |
| **Topicï¼ˆä¸»é¢˜ï¼‰**         | æ¶ˆæ¯é€šé“ï¼Œæ ¼å¼ï¼š`persistent://tenant/namespace/topic`        |
| **Partitioned Topic**     | æ”¯æŒåˆ†åŒºï¼Œæ¯ä¸ª Partition æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ Topic                  |
| **Subscriptionï¼ˆè®¢é˜…ï¼‰**  | æ¶ˆè´¹è€…ç»„çš„æŠ½è±¡ï¼Œæ”¯æŒå¤šç§æ¶ˆè´¹æ¨¡å¼                             |
| **Cursorï¼ˆæ¸¸æ ‡ï¼‰**        | è®°å½•æ¯ä¸ª Subscription çš„æ¶ˆè´¹ä½ç‚¹ï¼ˆç”± Broker ç®¡ç†ï¼‰           |

------

## ğŸ”„ æ¶ˆè´¹æ¨¡å¼ï¼ˆSubscription Typesï¼‰

Pulsar æ”¯æŒ **å››ç§è®¢é˜…ç±»å‹**ï¼Œçµæ´»åº”å¯¹ä¸åŒåœºæ™¯ï¼š

| ç±»å‹           | è¡Œä¸º                                                | ç±»ä¼¼              |
| -------------- | --------------------------------------------------- | ----------------- |
| **Exclusive**  | ä»…å…è®¸ä¸€ä¸ª Consumer æ¶ˆè´¹                            | RabbitMQ ç‹¬å é˜Ÿåˆ— |
| **Failover**   | å¤šä¸ª Consumerï¼Œä½†åªæœ‰ä¸» Consumer æ¶ˆè´¹ï¼ˆä¸»æŒ‚ååˆ‡æ¢ï¼‰ | ä¸»å¤‡æ¨¡å¼          |
| **Shared**     | å¤šä¸ª Consumer è´Ÿè½½å‡è¡¡æ¶ˆè´¹ï¼ˆæ— åºï¼‰                  | Kafka æ¶ˆè´¹è€…ç»„    |
| **Key_Shared** | æŒ‰ Key ä¿è¯é¡ºåºçš„è´Ÿè½½å‡è¡¡ï¼ˆç±»ä¼¼ Kafka åˆ†åŒºå†…æœ‰åºï¼‰  | Kafka åˆ†åŒº + Key  |

> âœ… **Key_Shared æ˜¯ Pulsar ç‹¬æœ‰ä¼˜åŠ¿**ï¼šåœ¨ Shared æ¨¡å¼ä¸‹ä»èƒ½ä¿è¯ **ç›¸åŒ Key çš„æ¶ˆæ¯é¡ºåº**ï¼Œæ— éœ€é¢„åˆ†é…åˆ†åŒºã€‚

------

## ğŸ› ï¸ é«˜çº§èƒ½åŠ›

### 1. **åˆ†å±‚å­˜å‚¨ï¼ˆTiered Storageï¼‰**

- çƒ­æ•°æ®å­˜ BookKeeperï¼ˆé«˜æ€§èƒ½ï¼‰
- å†·æ•°æ®è‡ªåŠ¨è½¬å­˜åˆ° **S3 / GCS / HDFS**ï¼ˆä½æˆæœ¬ï¼‰
- æ¶ˆè´¹è€…å¯é€æ˜è®¿é—®å†å²ä»»æ„æ¶ˆæ¯ï¼ˆæ— é™å›æº¯ï¼‰

### 2. **æ¶ˆæ¯ä¿ç•™ä¸ TTL**

- **Retention**ï¼šä¿ç•™å·²æ¶ˆè´¹æ¶ˆæ¯ï¼ˆç”¨äºé‡æ”¾ï¼‰
- **TTL**ï¼šæœªæ¶ˆè´¹æ¶ˆæ¯çš„å­˜æ´»æ—¶é—´
- ç­–ç•¥å¯æŒ‰ Namespace é…ç½®

### 3. **äº‹åŠ¡æ¶ˆæ¯ï¼ˆ2.7+ï¼‰**

- æ”¯æŒè·¨ Topic çš„åŸå­å†™å…¥
- é€‚ç”¨äº Exactly-Once æµå¤„ç†

### 4. **Pulsar Functions**

- è½»é‡çº§ FaaSï¼Œç±»ä¼¼ AWS Lambda
- æ”¯æŒ Java/Python/Goï¼Œå®ç°æ¶ˆæ¯è½¬æ¢ã€è¿‡æ»¤ã€èšåˆ

### 5. **Pulsar IOï¼ˆConnectorsï¼‰**

- å†…ç½® 100+ è¿æ¥å™¨ï¼ˆKafkaã€MySQLã€Elasticsearchã€S3 ç­‰ï¼‰
- æ›¿ä»£ Kafka Connect

------

## ğŸŒ åœ°ç†å¤åˆ¶ï¼ˆGeo-Replicationï¼‰

- è·¨é›†ç¾¤è‡ªåŠ¨å¼‚æ­¥å¤åˆ¶æ¶ˆæ¯
- æ”¯æŒ **Active-Active** å¤šæ´»æ¶æ„
- é€‚ç”¨äºç¾å¤‡ã€å…¨çƒéƒ¨ç½²

```mermaid
graph LR
    ClusterA[Pulsar Cluster A<br/>åŒ—äº¬] -->|å¼‚æ­¥å¤åˆ¶| ClusterB[Pulsar Cluster B<br/>ä¸Šæµ·]
    ClusterB -->|å¼‚æ­¥å¤åˆ¶| ClusterA

```

## âœ… æ€»ç»“

> **Apache Pulsar æ˜¯é¢å‘äº‘åŸç”Ÿæ—¶ä»£çš„ä¸‹ä¸€ä»£æ¶ˆæ¯å¹³å°ï¼Œé€šè¿‡â€œè®¡ç®—ä¸å­˜å‚¨åˆ†ç¦»â€æ¶æ„ï¼Œè§£å†³äº† Kafka åœ¨å¤šç§Ÿæˆ·ã€å¼¹æ€§ä¼¸ç¼©ã€é•¿æœŸå­˜å‚¨ç­‰æ–¹é¢çš„ç—›ç‚¹ã€‚**

å®ƒä¸ä»…æ˜¯ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ›´æ˜¯ä¸€ä¸ª **ç»Ÿä¸€çš„æ¶ˆæ¯ã€äº‹ä»¶æµã€æµå¤„ç†å¹³å°**ï¼Œç‰¹åˆ«é€‚åˆï¼š

- å¤§å‹ä¼ä¸šæ„å»º**ç»Ÿä¸€æ¶ˆæ¯åŸºç¡€è®¾æ–½**
- **å¤šäº‘/æ··åˆäº‘**éƒ¨ç½²åœºæ™¯
- éœ€è¦**æ— é™æ¶ˆæ¯å›æº¯**å’Œ**å¼ºä¸€è‡´æ€§**çš„ä¸šåŠ¡

è™½ç„¶è¿ç»´å¤æ‚åº¦ç•¥é«˜ï¼Œä½†å…¶æ¶æ„å…ˆè¿›æ€§ä½¿å…¶æˆä¸ºæœªæ¥æ¶ˆæ¯ä¸­é—´ä»¶çš„é‡è¦æ–¹å‘ã€‚

## ğŸ¥‡é›†æˆç¤ºä¾‹

âœ¨ä»£ç æ–‡ä»¶ï¼š[middleware-message/pulsar at master Â· xiaopengooo0/middleware-message](https://github.com/xiaopengooo0/middleware-message/tree/master/pulsar)

### 1.ä¾èµ–å¼•å…¥

```xml
        <dependency>
            <groupId>org.apache.pulsar</groupId>
            <artifactId>pulsar-client</artifactId>
            <version>4.0.7</version> <!-- å»ºè®®ä¸æœåŠ¡ç«¯ç‰ˆæœ¬ä¸€è‡´ -->
        </dependency>
```

### 2.é…ç½®æ–‡ä»¶

```yml
pulsar:
  service-url: pulsar://localhost:6650

```

> [!NOTE]
>
> `listener.type = batch ` å’Œ `max-poll-records = 3` æ˜¯æ‰¹é‡å¤„ç†ï¼Œé»˜è®¤æ˜¯å•æ¡å¤„ç†ã€‚å¯¹åº”ä¸‹æ–¹æ¶ˆè´¹è€…`consumeBatch`å¯ä»¥æ‰¹é‡å¤„ç†æ¶ˆæ¯ã€‚

### 3. é…ç½®æ³¨å…¥

```java
@Configuration
public class PulsarConfig {

    @Value("${pulsar.service-url:pulsar://localhost:6650}")
    private String serviceUrl;

    @Bean
    public PulsarClient pulsarClient() throws PulsarClientException {
        return PulsarClient.builder()
                .serviceUrl(serviceUrl)
                .build();
    }
}
```

### 4.ç”Ÿäº§è€…é…ç½®

```java
@Component
public class PulsarProducer {
    
    @Autowired
    private PulsarClient pulsarClient;
    
    private Producer<String> producer;

    private static final String TOPIC = "persistent://public/default/user-topic";

    @PostConstruct
    public void init() throws PulsarClientException {
        producer = pulsarClient.newProducer(Schema.STRING)
                .topic(TOPIC)
                .compressionType(CompressionType.LZ4)
                .sendTimeout(10, TimeUnit.SECONDS)
                .create();
    }

    @PreDestroy
    public void cleanup() throws PulsarClientException {
        if (producer != null) {
            producer.close();
        }
    }

    // å‘é€åŒæ­¥æ¶ˆæ¯
    public void sendSyncMessage(String message) throws PulsarClientException {
        MessageId messageId = producer.send(message);
        System.out.println("Sent message with ID: " + messageId);
    }

    // å‘é€å¼‚æ­¥æ¶ˆæ¯
    public void sendAsyncMessage(String message) {
        producer.sendAsync(message)
                .thenAccept(messageId -> {
                    System.out.println("Sent message successfully with ID: " + messageId);
                })
                .exceptionally(throwable -> {
                    System.err.println("Failed to send message: " + throwable.getMessage());
                    return null;
                });
    }

    // å‘é€å¸¦å±æ€§çš„æ¶ˆæ¯
    public void sendMessageWithProperties(String message, Map<String, String> properties)
            throws PulsarClientException {
        TypedMessageBuilder<String> messageBuilder = producer.newMessage()
                .value(message);

        properties.forEach(messageBuilder::property);

        messageBuilder.send();
    }

    // å‘é€å»¶è¿Ÿæ¶ˆæ¯
    public void sendDelayedMessage(String message, long delay, TimeUnit unit)
            throws PulsarClientException {
        producer.newMessage()
                .value(message)
                .deliverAfter(delay, unit)
                .send();
    }
```

### 5.æ¶ˆè´¹è€…é…ç½®

```java
@Component
public class PulsarConsumer {

    private static final Logger log = LoggerFactory.getLogger(PulsarConsumer.class);
    @Autowired
    private PulsarClient pulsarClient;
    
    private Consumer<String> consumer;
    
    private static final String TOPIC = "persistent://public/default/user-topic";
    private static final String SUBSCRIPTION = "my-subscription";

    /**
     * åˆå§‹åŒ–æ¶ˆè´¹è€…
     */
    @PostConstruct
    public void init() throws PulsarClientException {
        consumer = pulsarClient
                .newConsumer(Schema.STRING) // æ¶ˆæ¯æ ¼å¼
                .topic(TOPIC) // ä¸»é¢˜
                .subscriptionName(SUBSCRIPTION) // è®¢é˜…åç§°
                .subscriptionType(SubscriptionType.Shared) // Shared, Failover, Exclusive, Key_Shared
                .subscriptionInitialPosition(SubscriptionInitialPosition.Earliest) // è®¢é˜…åˆå§‹ä½ç½®
                .negativeAckRedeliveryDelay(10, TimeUnit.SECONDS) // å¦å®šç¡®è®¤å»¶è¿Ÿ
                .subscribe();
        
        startConsuming(); // å¯åŠ¨æ¶ˆè´¹
    }
    
    @PreDestroy
    public void cleanup() throws PulsarClientException {
        if (consumer != null) {
            consumer.close();
        }
    }
    
    private void startConsuming() {
        Executors.newSingleThreadExecutor().submit(() -> {
            while (true) {
                try {
                    // æ¥æ”¶æ¶ˆæ¯ï¼ˆé˜»å¡ï¼‰
                    Message<String> message = consumer.receive();
                    
                    try {
                        log.info("Received message: " + message.getValue()+ (message.getProperty("key")==null?"":" key:"+message.getProperty("key")));
                        // å¤„ç†ä¸šåŠ¡
                        processMessage(message.getValue());
                        // ç¡®è®¤æ¶ˆæ¯
                        consumer.acknowledge(message);
                    } catch (Exception e) {
                        log.error("Failed to process message, negative ack: " + e.getMessage());
                        // å¦å®šç¡®è®¤ï¼Œæ¶ˆæ¯ä¼šé‡æ–°æŠ•é€’
                        consumer.negativeAcknowledge(message);
                    }
                    
                } catch (PulsarClientException e) {
                    log.error("Error receiving message: " + e.getMessage());
                }
            }
        });
    }
    
    // æ‰¹é‡ç›‘å¬æ–¹å¼
    public void startBatchConsuming() throws PulsarClientException {
        try (Consumer<String> batchConsumer = pulsarClient.newConsumer(Schema.STRING)
                .topic(TOPIC)
                .subscriptionName("batch-subscription")
                .batchReceivePolicy(BatchReceivePolicy.builder()
                        .maxNumMessages(100)
                        .maxNumBytes(10 * 1024 * 1024)
                        .timeout(1, TimeUnit.SECONDS)
                        .build())
                .subscribe()) {

            Executors.newSingleThreadExecutor().submit(() -> {
                while (true) {
                    try {
                        // æ‰¹é‡æ¥æ”¶
                        Messages<String> messages = batchConsumer.batchReceive();

                        for (Message<String> message : messages) {
                            try {
                                processMessage(message.getValue());
                                batchConsumer.acknowledge(message);
                            } catch (Exception e) {
                                batchConsumer.negativeAcknowledge(message);
                            }
                        }

                    } catch (PulsarClientException e) {
                        log.error("Error in batch consumption: " + e.getMessage());
                    }
                }
            });
        }
    }
    
    private void processMessage(String message) {
        // å…·ä½“çš„ä¸šåŠ¡å¤„ç†é€»è¾‘
        log.info("Processing: " + message);
    }
}
```

### 6. æµ‹è¯•æ¶ˆæ¯

```java
@SpringBootTest
@RunWith(SpringRunner.class)
public class ApiTest {

    @Resource
    private PulsarProducer pulsarProducer;

    @Resource
    private PulsarMultiTenantProducer pulsarMultiTenantProducer;


    @Test
    public void sendMessage() throws PulsarClientException, InterruptedException {
        pulsarProducer.sendSyncMessage("Hello, Pulsar! ---Sync---");
        pulsarProducer.sendAsyncMessage("Hello, Pulsar! ---Async---");
        pulsarProducer.sendMessageWithProperties("Hello, Pulsar! --Property-- ", Map.of("key", "value"));
        pulsarProducer.sendDelayedMessage("Hello, Pulsar! ---Delayed---", 5, TimeUnit.SECONDS);

        Thread.sleep(5000);


        pulsarMultiTenantProducer.sendToTenant("public", "default", "user-topic", "Hello, Pulsar! ---MultiTenant---");
    }
}
```

### è¾“å‡ºç¤ºä¾‹

```powershell
Sent message with ID: 3:12:-1
2025-10-31 16:07:17.331  INFO 27240 --- [pool-1-thread-1] c.s.m.pulsar.consumer.PulsarConsumer     : Received message: Hello, Pulsar! ---Sync---
2025-10-31 16:07:17.331  INFO 27240 --- [pool-1-thread-1] c.s.m.pulsar.consumer.PulsarConsumer     : Processing: Hello, Pulsar! ---Sync---
Sent message successfully with ID: 3:13:-1:0
2025-10-31 16:07:17.336  INFO 27240 --- [pool-1-thread-1] c.s.m.pulsar.consumer.PulsarConsumer     : Received message: Hello, Pulsar! ---Async---
2025-10-31 16:07:17.336  INFO 27240 --- [pool-1-thread-1] c.s.m.pulsar.consumer.PulsarConsumer     : Processing: Hello, Pulsar! ---Async---
2025-10-31 16:07:17.336  INFO 27240 --- [pool-1-thread-1] c.s.m.pulsar.consumer.PulsarConsumer     : Received message: Hello, Pulsar! --Property--  key:value
2025-10-31 16:07:17.336  INFO 27240 --- [pool-1-thread-1] c.s.m.pulsar.consumer.PulsarConsumer     : Processing: Hello, Pulsar! --Property-- 
2025-10-31 16:07:22.493  INFO 27240 --- [pool-1-thread-1] c.s.m.pulsar.consumer.PulsarConsumer     : Received message: Hello, Pulsar! ---Delayed---
2025-10-31 16:07:22.493  INFO 27240 --- [pool-1-thread-1] c.s.m.pulsar.consumer.PulsarConsumer     : Processing: Hello, Pulsar! ---Delayed---
2025-10-31 16:07:27.341  INFO 27240 --- [r-client-io-1-3] o.a.p.c.impl.ProducerStatsRecorderImpl   : Starting Pulsar producer perf with config: {"topicName":"persistent://public/default/user-topic","producerName":null,"sendTimeoutMs":30000,"blockIfQueueFull":false,"maxPendingMessages":0,"maxPendingMessagesAcrossPartitions":0,"messageRoutingMode":"RoundRobinPartition","hashingScheme":"JavaStringHash","cryptoFailureAction":"FAIL","batchingMaxPublishDelayMicros":1000,"batchingPartitionSwitchFrequencyByPublishDelay":10,"batchingMaxMessages":1000,"batchingMaxBytes":131072,"batchingEnabled":true,"chunkingEnabled":false,"chunkMaxMessageSize":-1,"encryptionKeys":[],"compressionType":"NONE","initialSequenceId":null,"autoUpdatePartitions":true,"autoUpdatePartitionsIntervalSeconds":60,"multiSchema":true,"accessMode":"Shared","lazyStartPartitionedProducers":false,"properties":{},"initialSubscriptionName":null,"replProducer":false,"nonPartitionedTopicExpected":false}
2025-10-31 16:07:27.341  INFO 27240 --- [r-client-io-1-3] o.a.p.c.impl.ProducerStatsRecorderImpl   : Pulsar client config: {"serviceUrl":"pulsar://localhost:6650","authPluginClassName":null,"authParams":null,"authParamMap":null,"originalPrincipal":null,"operationTimeoutMs":30000,"lookupTimeoutMs":30000,"statsIntervalSeconds":60,"numIoThreads":12,"numListenerThreads":12,"connectionsPerBroker":1,"connectionMaxIdleSeconds":60,"useTcpNoDelay":true,"useTls":false,"tlsKeyFilePath":null,"tlsCertificateFilePath":null,"tlsTrustCertsFilePath":null,"tlsAllowInsecureConnection":false,"tlsHostnameVerificationEnable":false,"sslFactoryPlugin":"org.apache.pulsar.common.util.DefaultPulsarSslFactory","sslFactoryPluginParams":"","concurrentLookupRequest":5000,"maxLookupRequest":50000,"maxLookupRedirects":20,"maxNumberOfRejectedRequestPerConnection":50,"keepAliveIntervalSeconds":30,"connectionTimeoutMs":10000,"requestTimeoutMs":60000,"readTimeoutMs":60000,"autoCertRefreshSeconds":300,"initialBackoffIntervalNanos":100000000,"maxBackoffIntervalNanos":60000000000,"enableBusyWait":false,"listenerName":null,"useKeyStoreTls":false,"sslProvider":null,"tlsKeyStoreType":"JKS","tlsKeyStorePath":null,"tlsKeyStorePassword":null,"tlsTrustStoreType":"JKS","tlsTrustStorePath":null,"tlsTrustStorePassword":null,"tlsCiphers":[],"tlsProtocols":[],"memoryLimitBytes":67108864,"proxyServiceUrl":null,"proxyProtocol":null,"enableTransaction":false,"dnsLookupBindAddress":null,"dnsLookupBindPort":0,"dnsServerAddresses":[],"socks5ProxyAddress":null,"socks5ProxyUsername":null,"socks5ProxyPassword":null,"description":null,"lookupProperties":{},"openTelemetry":null}
2025-10-31 16:07:27.344  INFO 27240 --- [r-client-io-1-3] o.a.pulsar.client.impl.ProducerImpl      : [persistent://public/default/user-topic] [null] Creating producer on cnx [id: 0xbb4bd545, L:/127.0.0.1:64993 - R:localhost/127.0.0.1:6650]
2025-10-31 16:07:27.348  INFO 27240 --- [r-client-io-1-3] o.a.pulsar.client.impl.ProducerImpl      : [persistent://public/default/user-topic] [standalone-0-5] Created producer on cnx [id: 0xbb4bd545, L:/127.0.0.1:64993 - R:localhost/127.0.0.1:6650]
2025-10-31 16:07:27.354  INFO 27240 --- [           main] o.a.p.c.impl.ProducerStatsRecorderImpl   : [persistent://public/default/user-topic] [standalone-0-5] --- Publish throughput: 89.91 msg/s --- 0.02 Mbit/s --- Latency: med: 3.000 ms - 95pct: 3.000 ms - 99pct: 3.000 ms - 99.9pct: 3.000 ms - max: 3.000 ms --- BatchSize: med: 1.000 - 95pct: 1.000 - 99pct: 1.000 - 99.9pct: 1.000 - max: 1.000 --- MsgSize: med: 32.000 bytes - 95pct: 32.000 bytes - 99pct: 32.000 bytes - 99.9pct: 32.000 bytes - max: 32.000 bytes --- Ack received rate: 89.91 ack/s --- Failed messages: 0 --- Pending messages: 0
2025-10-31 16:07:27.354  INFO 27240 --- [pool-1-thread-1] c.s.m.pulsar.consumer.PulsarConsumer     : Received message: Hello, Pulsar! ---MultiTenant---
2025-10-31 16:07:27.354  INFO 27240 --- [pool-1-thread-1] c.s.m.pulsar.consumer.PulsarConsumer     : Processing: Hello, Pulsar! ---MultiTenant---
2025-10-31 16:07:27.357  INFO 27240 --- [r-client-io-1-3] o.a.pulsar.client.impl.ProducerImpl      : [persistent://public/default/user-topic] [standalone-0-5] Closed Producer

```

### docker é…ç½®

`docker-compose.yml`

```yml
version: '3.8'


services:
  # pulsar
  pulsar:
    image: apachepulsar/pulsar:4.0.7
    container_name: pulsar-standalone
    ports:
      - "6650:6650"   # Pulsar client port (pulsar://)
      - "8080:8080"   # Admin HTTP API (http://)
    environment:
      - PULSAR_PREFIX_brokerDeleteInactiveTopicsEnabled=false
      - PULSAR_PREFIX_brokerDeleteInactiveTopicsFrequencySeconds=600
    volumes:
      - pulsar_data:/pulsar/data
      - pulsar_logs:/pulsar/logs
    command: >
      /bin/bash -c
      "bin/pulsar standalone --no-functions-worker --no-stream-storage"
    restart: unless-stopped

volumes:
  pulsar_data:
  pulsar_logs:



```

é•œåƒåœ°å€ï¼š`swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/apachepulsar/pulsar:3.0.7-linuxarm64`